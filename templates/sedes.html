{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Nuestras Sedes | San Agustín</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/estilos.css' %}">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        /* Hacemos que el mapa ocupe toda la altura disponible */
        .map-container { height: 80vh; width: 100%; border-radius: 10px; overflow: hidden; }
        .sede-card { cursor: pointer; transition: 0.2s; border-left: 5px solid transparent; }
        .sede-card:hover { background-color: #f8f9fa; border-left: 5px solid var(--primary-dark); }
        .sede-card.active { background-color: #e9ecef; border-left: 5px solid var(--primary-dark); }
    </style>
</head>
<body>

    <nav class="navbar wp-navbar">
        <div class="container justify-content-center">
            <a class="brand-wp" href="{% url 'index' %}">San Agustín</a>
        </div>
    </nav>

    <div class="container-fluid px-0">
        <div class="row g-0">
            
            <div class="col-md-4 col-lg-3 bg-white border-end shadow-sm" style="height: 90vh; overflow-y: auto;">
                <div class="p-4">
                    <h4 class="fw-bold text-primary mb-4">Nuestras Ópticas</h4>
                    <p class="text-muted small">Encuentra la sede más cercana a ti.</p>
                </div>
                
                <div class="list-group list-group-flush">
                    {% for sede in sedes %}
                    <div class="list-group-item p-4 sede-card" onclick="centrarMapa({{ sede.latitud }}, {{ sede.longitud }}, '{{ sede.nombre }}')">
                        <h5 class="fw-bold mb-1">{{ sede.nombre }}</h5>
                        <p class="mb-2 text-muted small"><span class="material-icons align-middle fs-6">place</span> {{ sede.direccion|default:"Lima Norte" }}</p>
                        <p class="mb-0 text-success small fw-bold"><span class="material-icons align-middle fs-6">schedule</span> {{ sede.horario }}</p>
                        <a href="https://www.google.com/maps/search/?api=1&query={{ sede.latitud }},{{ sede.longitud }}" target="_blank" class="btn btn-outline-dark btn-sm rounded-pill mt-3 w-100">
                            Cómo llegar
                        </a>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="col-md-8 col-lg-9 bg-light p-0 position-relative">
                <div id="map" style="height: 90vh; width: 100%;"></div>
            </div>
            
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // Coordenadas iniciales (Centro entre tus sedes, aprox Comas)
        var map = L.map('map').setView([-11.9309, -77.0545], 13);

        // Cargamos el diseño del mapa (OpenStreetMap - Estilo limpio)
        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Icono personalizado (Opcional, para que se vea rojo como Google)
        var redIcon = new L.Icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });

        // Bucle mágico de Django para poner los pines
        {% for sede in sedes %}
            L.marker([{{ sede.latitud }}, {{ sede.longitud }}], {icon: redIcon})
                .addTo(map)
                .bindPopup("<b>{{ sede.nombre }}</b><br>{{ sede.horario }}");
        {% endfor %}

        // Función para mover el mapa cuando clic en la lista
        function centrarMapa(lat, lng, nombre) {
            map.flyTo([lat, lng], 16, {
                animate: true,
                duration: 1.5
            });
        }
    </script>

</body>
</html>